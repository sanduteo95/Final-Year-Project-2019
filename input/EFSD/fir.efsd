let pair = λx.λy.λz.z x y in
let fst = λp.p (λx.λy.x) in
let snd = λp.p (λx.λy.y) in

let nil = pair true true in 
let isnil = fst in 
let cons = λh.λt. pair false (pair h t) in
let head = λz. fst (snd z) in
let tail = λz. snd (snd z) in 

let fir = rec g. λx. λl.
  if isnil l 
  then 
    pair x 0
  else 
    let f = head l in 
    let fs = tail l in 
    let result = g x fs in 
    let s = {0} in 
    let _ = link s to deref (fst result) in 
    pair s (f s + (snd result))
in 

let avg3 = λx. 
   let w = λx. x / 3 in 
   let l = cons w (cons w (cons w nil)) in
   snd (fir x l)
in

let inp = {0} in 
avg3 inp
