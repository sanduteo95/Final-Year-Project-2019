# Application of the first Futamura Projection on a toy lambda calculus language

JavaScript interpreter implemented with the help of [Jison](https://github.com/zaach/jison) and [Lex](https://github.com/aaditmshah/lexer). 

Applies the first of three [Futamura projections](https://en.wikipedia.org/wiki/Partial_evaluation) with the help of [Prepack](https://github.com/facebook/prepack).

## What it does
It contains a lexer, parser, interpreter and a first application of the first Futamura projection on the interpreter. 
* The lexer tokenises and checks for incorrect syntax.
* The parser takes a string of code representing a program and produces an abstract syntax tree.
* The interpreter takes a string representing a lambda calculus program and goes through the parse tree generated by the parser to evaluate the value returned by the lambda term.
* The first Futamura projection works based on the interpreter above, by running Prepack on the source code.

## About the language
The toy language is an implementation of lambda calculus, allowing I/O and returning lambda abstractions (i.e. functions in JavaScript). It allows the following:

* Lambda application: `(λx.x+1) @ 1` (evaluates to 1)
* Nested lambda abstractions: `(λx.(λy. x < y)) @ 1 @ 2` (evaluates to `true`)
* Defined lambdas: `let incr = λx.x+1 in (λx. incr @ x) @ 1` (evaluates to 2)
* Exporting abstractions: `let export = λx. x + 1 in export`
* Printing: `(λx.print @ x) @ 1` (prints 1 but evaluates to `true`)
* Reading: `(λx.x) @ read` (evaluates to whatever **number** the user has provided)
* Recursion: `let rec f = λx. λsum. (x < 10 && (f @ (x + 1)) @ (sum + x)) || sum in (f @ 1) @ 0`  (evaluates to 45)


## Local development instructions
Run `npm run install` and then run the program following the instructions bellow:

`node index.js -V` - to return the version of the tool

`node index.js -h` - to return possible options for running the tool

`node index.js -p <pathToFile>` - to print out the parse tree for the provided file

`node index.js -i [-d] [-t] [-s value] <pathToFile>` - to return the result of interpreter on the provided file

`node index.js -f [-d] [-t] [-s value] <pathToFile>` - to return the result of applying the first Futamura projection on the provided file

Optional flags are:
* `-d`: to allow debugging log
* `-t`: to get execution time
* `-s value`: to set up the maximum number of consecutive recursive calls allowed

In case of `RangeError: Maximum call stack size exceeded` errors, add a `--stack-size=<value>` to the command. 
i.e. `node --stack-size=100000 index.js -i <pathToFile>`

The results can be tested out with various `-s` options passed through and analysed by looking in the `output` folder.

For example, running `node --stack-size=100000 index.js -i input/toyLambda/church.lambda -s 600` shows how the first projection is able to return the final result of the church encoding calculations. 

## How to run it
Install `futamura-js` globally by running `npm install -g futamura-js` and then type in `futamura-js --help` to see what options there are. 